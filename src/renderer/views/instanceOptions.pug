doctype html
html(lang="en")
	head
		meta(charset="UTF-8")
		meta(name="viewport" content="width=device-width, initial-scale=1.0")
		meta(http-equiv="X-UA-Compatible", content="ie=edge")
		// css
		// semantic-ui
		link(rel="stylesheet" href="../../src/renderer/css/semantic.min.css")
		block css
		// js
		// load modules
		script(link-js-library).
			require("v8-compile-cache");
			const jQuery = window.$ = require('jquery');
			const { ApplicationStore } = require("../js/universal/store");
			const { remote, ipcRenderer } = require("electron");
			// get instance name
			const instanceName = remote.getCurrentWindow().instanceName; // FIXME: see main process
			const { refreshEventHandlers, instanceData } = require("../js/renderer/controllers/InstanceOptionsController.js");
		script(src='../../src/renderer/js/semantic.min.js' link-js-library)

		// page views
		- const pages = [ "general", "worlds" ]; // pages that are availible
		//- expose to js
		script const pages = [ "general", "worlds" ]; // TODO: make this generate from pugjs var

		// load templates
		each page in pages
			script(src=`../templates/instanceOptions/${page}.js`)

		// event logic
		script.
			const templateOptions = {

			}
			// page logic
			const switchPage = (page) => {
				if (!$("#button-saveOptions").hasClass("disabled")) { // there are unsaved changes
					const switchConfirm = confirm("You have unsaved changes. Are you sure you want to switch pages?");
					if (!switchConfirm) {
						return;
					}
				}
				const fn = window[`${page}Template`];
				if(fn === undefined) throw Error("A page with this name does not exist")
				const htmlStr = fn.apply(templateOptions);
				$("#options-contentArea").html(htmlStr);
				refreshEventHandlers();
			}

			// start on a page
			$(() => {
				// check for BrowserWindow data
				const startPage = remote.getCurrentWindow().startPage || "general";
				switchPage(startPage);
			});

			// listen for ipc to change page
			ipcRenderer.on("switchPage", (event, ...args) => {
				if (args.length === 0 || typeof args[0] !== "string") throw TypeError("Expected args[0] to be of type `string`");
				if (args!== undefined)
					switchPage(args[0]);
			});
	body
		.ui.container
			h1#heading-instanceName
			script.
				$("#heading-instanceName").html(`${instanceName} | Options`) // TODO: change entire page to pugJS template
		//- content area
		.ui.grid(style="margin-left: 10px; margin-right: 10px;")
			.three.wide.column
				.ui.vertical.fluid.menu
					each page in pages
						a.item(onclick=`switchPage("${page}")`) #{page.charAt(0).toUpperCase() + page.slice(1)}
			.thirteen.wide.stretched.column#options-contentArea
		// footer
		.ui.bottom.fixed.menu
			.right.menu
				.item
					.ui.buttons
						.ui.button(onclick="remote.getCurrentWindow().close()") Cancel
						.or
						.ui.disabled.primary.button#button-saveOptions Save and close